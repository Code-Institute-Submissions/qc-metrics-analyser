{% extends '/bases/base.html' %}
{% block navbar %}

    <nav class="navbar navbar-expand-sm navbar-dark">
        <div class="member-status user">User: <span>{{ username }}</span></div>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navigation">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item"><a class="nav-link" href="{{ url_for('user', username=username) }}"><i class="fas fa-user"></i>User</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('addUserRun') }}"><i class="fas fa-plus-circle"></i>Add Run</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('viewUserRuns') }}"><i class="fas fa-sort-amount-up"></i>Manage Runs</a></li>
                <li class="nav-item"><a class="nav-link login-btn" href="{{ url_for('logout') }}">Logout</a></li>
            </ul>
        </div>
    </nav>

{% endblock navbar %}

{% block content %}
    
    <section class="container">
        <!--SEQUENCING-RUNS-->
        <h3>Sequencing Run Metrics</h3>
        <hr>

        <div class="row justify-content-center">
            <div class="col-10 col-sm-5 col-md-5 col-lg-4">
                <h4>Yield</h4>
                <a data-toggle="modal" data-target="#yieldModal">
                    <div class="overlay-container-1">
                        <img class="img-overlay" src="{{ url_for('static', filename='images/yield.jpg') }}" alt="yield">
                        <div class="overlay">
                        <div class="overlay-text">Yield</div>
                        </div>
                    </div>
                </a>
            </div>

            <div class="col-10 col-sm-5 col-md-5 col-lg-4">
                <h4>Cluster Density</h4>
                <a data-toggle="modal" data-target="#clusterDensityModal">
                <div class="overlay-container-2">
                    <img class="img-overlay" src="{{ url_for('static', filename='images/clusters.jpg') }}" alt="clusters">
                    <div class="overlay">
                    <div class="overlay-text">Cluster Density</div>
                    </div>
                </div>
                </a>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-10 col-sm-5 col-md-5 col-lg-4">
                <h4>Pass Filter</h4>
                <a data-toggle="modal" data-target="#passFilterModal">
                <div class="overlay-container-3">
                    <img class="img-overlay" src="{{ url_for('static', filename='images/pass-filter.jpg') }}" alt="clusters passing filter">
                    <div class="overlay">
                    <div class="overlay-text">Clusters Passing Filter</div>
                    </div>
                </div>
                </a>
            </div>

            <div class="col-10 col-sm-5 col-md-5 col-lg-4">
                <h4>Q30 Score</h4>
                <a data-toggle="modal" data-target="#q30Modal">
                <div class="overlay-container-4">
                    <img class="img-overlay" src="{{ url_for('static', filename='images/q30-score2.jpg') }}" alt="homepage-3">
                    <div class="overlay">
                    <div class="overlay-text">Q30 Score</div>
                    </div>
                </div>
                </a>
            </div>
        </div>

        <div id="yieldModal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content qc-data">
                    <div class="modal-header qc-data-header">
                        <h4 class="modal-title"><span class="d-none d-md-inline-block">User: {{ username }}</span>Yield - Gigabases</h4>
                    </div>
                    <div class="modal-body qc-data-list">
                        <ul class="d-none d-md-block">
                            <li>Average: {{ runData.yields.average|int() }}</li>
                            <li>Minimum: {{ runData.yields.minimum|int() }}</li>
                            <li>Maximum: {{ runData.yields.maximum|int() }}</li>
                        </ul>
                        <div id="yieldChartContainer" class="chart-container">
                            <canvas id="yield-chart"></canvas>
                        </div>
                    </div>
                    <div class="modal-footer qc-data-footer">
                        <button type="button" class="btn qc-data-btn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="clusterDensityModal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content qc-data">
                    <div class="modal-header qc-data-header">
                        <h4 class="modal-title"><span class="d-none d-md-inline-block">User: {{ username }}</span>Cluster Density - K/mm2</h4>
                    </div>
                    <div class="modal-body qc-data-list">
                        <ul class="d-none d-md-block">
                            <li>Average: {{ runData.clusterDensity.average|int() }}</li>
                            <li>Minimum: {{ runData.clusterDensity.minimum|int() }}</li>
                            <li>Maximum: {{ runData.clusterDensity.maximum|int() }}</li>
                        </ul>
                        <div id="clusterChartContainer" class="chart-container">
                            <canvas id="clusterDensity-chart"></canvas>
                        </div>
                    </div>
                    <div class="modal-footer qc-data-footer">
                        <button type="button" class="btn qc-data-btn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="passFilterModal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content qc-data">
                    <div class="modal-header qc-data-header">
                        <h4 class="modal-title"><span class="d-none d-md-inline-block">User: {{ username }}</span>Pass Filter - %</h4>
                    </div>
                    <div class="modal-body qc-data-list">
                        <ul class="d-none d-md-block">
                            <li>Average: {{ runData.passFilter.average|int() }}</li>
                            <li>Minimum: {{ runData.passFilter.minimum|int() }}</li>
                            <li>Maximum: {{ runData.passFilter.maximum|int() }}</li>
                        </ul>
                        <div id="passFilterChartContainer" class="chart-container">
                            <canvas id="passFilter-chart"></canvas>
                        </div>
                    </div>
                    <div class="modal-footer qc-data-footer">
                        <button type="button" class="btn qc-data-btn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="q30Modal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content qc-data">
                    <div class="modal-header qc-data-header">
                        <h4 class="modal-title"><span class="d-none d-md-inline-block">User: {{ username }}</span>Q30 Score - %</h4>
                    </div>
                    <div class="modal-body qc-data-list">
                        <ul class="d-none d-md-block">
                            <li>Average: {{ runData.q30.average|int() }}</li>
                            <li>Minimum: {{ runData.q30.minimum|int() }}</li>
                            <li>Maximum: {{ runData.q30.maximum|int() }}</li>
                        </ul>
                        <div id="q30ChartContainer" class="chart-container">
                            <canvas id="q30-chart"></canvas>
                        </div>
                    </div>
                    <div class="modal-footer qc-data-footer">
                        <button type="button" class="btn qc-data-btn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--SEQUENCING-RUNS-END-->

    <!--OTHER-SEQUENCING-METRICS-->
    <section class="container">
        <h3>Other Sequencing Metrics</h3>
        <hr>
        <div class="row justify-content-center other-metrics">
            <div class="col-10 col-sm-5 col-md-5 col-lg-4">
                <h4>Chemistry</h4>
                <a data-toggle="modal" data-target="#chemistryModal">
                <div class="overlay-container-5">
                    <img class="img-overlay" src="{{ url_for('static', filename='images/chemistry.jpg') }}" alt="homepage-5">
                    <div class="overlay">
                    <div class="overlay-text">Sequencing Chemistry</div>
                    </div>
                </div>
                </a>
            </div>

            <div class="col-10 col-sm-5 col-md-5 col-lg-4">
                <h4>Experiments</h4>
                <a data-toggle="modal" data-target="#experimentModal">
                <div class="overlay-container-6">
                    <img class="img-overlay" src="{{ url_for('static', filename='images/experiments.jpg') }}" alt="experiments">
                    <div class="overlay">
                    <div class="overlay-text">Sequencing Experiments</div>
                    </div>
                </div>
                </a>
            </div>
        </div>

        <div id="chemistryModal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content qc-data">
                    <div class="modal-header qc-data-header">
                        <h4 class="modal-title"><span class="d-none d-md-inline-block">User: {{ username }}</span>Chemistry</h4>
                    </div>
                    <div class="modal-body qc-data-list">
                        <ul>
                            <li>High300: {{ experimentData.high300 }}</li>
                            <li>Mid300: {{ experimentData.mid300 }}</li>
                            <li>Mid150: {{ experimentData.mid150 }}</li>
                        </ul>
                        <div class="chart-container">
                            <canvas id="chemistry-chart"></canvas>
                        </div>
                    </div>
                    <div class="modal-footer qc-data-footer">
                        <button type="button" class="btn qc-data-btn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="experimentModal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content qc-data">
                    <div class="modal-header qc-data-header">
                        <h4 class="modal-title"><span class="d-none d-md-inline-block">User: {{ username }}</span>Experiments</h4>
                    </div>
                    <div class="modal-body qc-data-list">
                        <ul>
                            <li>Genome: {{ experimentData.genome }}</li>
                            <li>Exome: {{ experimentData.exome }}</li>
                            <li>Capture: {{ experimentData.capture }}</li>
                        </ul>
                        <div class="chart-container">
                            <canvas id="experiment-chart"></canvas>
                        </div>
                    </div>
                    <div class="modal-footer qc-data-footer">
                        <button type="button" class="btn qc-data-btn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--OTHER-SEQUENCING-METRICS-END-->            

{% endblock content %}

{% block footer_navbar %}

    <div class="row no-gutters footer-nav">
        <div class="col-12">
            <ul>
                <li><a href="#"><i class="fas fa-arrow-circle-up"></i>Top</a></li>
            </ul>
            <ul>
                <li><a href="{{ url_for('user', username=username) }}"><i class="fas fa-user"></i>User</a></li>
                <li><a href="{{ url_for('addUserRun') }}"><i class="fas fa-plus-circle"></i>Add Run</a></li>
                <li><a href="{{ url_for('viewUserRuns') }}"><i class="fas fa-sort-amount-up"></i>Manage Runs</a></li>
                <li><a class="footer-btn footer-login-btn" href="{{ url_for('logout') }}">Logout</a></li>
            </ul>
        </div>
    </div>

{% endblock footer_navbar %}

{% block javascript %}
    <script>
        let labels = JSON.parse({{ labels|tojson }});
        let yields = JSON.parse({{ yields|tojson }});
        let clusterDensity = JSON.parse({{ clusterDensity|tojson }});
        let passFilter = JSON.parse({{ passFilter|tojson }});
        let q30 = JSON.parse({{ q30|tojson }});

        let chemistries = [];
        chemistries.push(JSON.parse({{ experimentData.genome|tojson }}));
        chemistries.push(JSON.parse({{ experimentData.exome|tojson }}));
        chemistries.push(JSON.parse({{ experimentData.capture|tojson }}));

        let experiments = [];
        experiments.push(JSON.parse({{ experimentData.high300|tojson }}));
        experiments.push(JSON.parse({{ experimentData.mid300|tojson }}));
        experiments.push(JSON.parse({{ experimentData.mid150|tojson }}));
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="/static/js/graphs.js"></script>

{% endblock javascript %}