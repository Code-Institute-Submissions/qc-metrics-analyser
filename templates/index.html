{% extends '/bases/base.html' %}
{% block navbar %}

    <nav class="navbar navbar-expand-sm navbar-dark">
        <a class="navbar-brand" href="#">
            <img src="{{ url_for('static', filename='images/qc-metrics-analyser-logo.png') }}" alt="logo">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navigation">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item"><a class="nav-link login-btn" href="{{ url_for('login') }}">Login</a></li>
                <li class="nav-item"><a class="nav-link login-btn signup-btn" href="{{ url_for('signup') }}">Sign Up</a></li>
            </ul>
        </div>
    </nav>

{% endblock navbar %}

{% block content %}

   <!--SEQUENCING-RUNS-->
    <section class="container">
        <h3>Sequencing Run Metrics</h3>
        <hr>

        <div class="row justify-content-center">
            <div class="col-10 col-sm-5 col-md-5 col-lg-4">
                <h4 class="page-subtitle">Yield</h4>
                <a data-toggle="modal" data-target="#yieldModal">
                    <div class="overlay-container-1">
                        <img class="img-overlay" src="{{ url_for('static', filename='images/yield.jpg') }}" alt="yield">
                        <div class="overlay">
                        <div class="overlay-text">Yield</div>
                        </div>
                    </div>
                </a>
            </div>

            <div class="col-10 col-sm-5 col-md-5 col-lg-4"">
                <h4 class="page-subtitle">Cluster Density</h4>
                <a data-toggle="modal" data-target="#clusterDensityModal">
                <div class="overlay-container-2">
                    <img class="img-overlay" src="{{ url_for('static', filename='images/clusters.jpg') }}" alt="clusters">
                    <div class="overlay">
                    <div class="overlay-text">Cluster Density</div>
                    </div>
                </div>
                </a>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-10 col-sm-5 col-md-5 col-lg-4"">
                <h4 class="page-subtitle">Pass Filter</h4>
                <a data-toggle="modal" data-target="#passFilterModal">
                <div class="overlay-container-3">
                    <img class="img-overlay" src="{{ url_for('static', filename='images/pass-filter.jpg') }}" alt="clusters passing filter">
                    <div class="overlay">
                    <div class="overlay-text">Clusters Passing Filter</div>
                    </div>
                </div>
                </a>
            </div>

            <div class="col-10 col-sm-5 col-md-5 col-lg-4"">
                <h4 class="page-subtitle">Q30 Score</h4>
                <a data-toggle="modal" data-target="#q30Modal">
                <div class="overlay-container-4">
                    <img class="img-overlay" src="{{ url_for('static', filename='images/q30-score2.jpg') }}" alt="homepage-3">
                    <div class="overlay">
                    <div class="overlay-text">Q30 Score</div>
                    </div>
                </div>
                </a>
            </div>
        </div>

        <div id="yieldModal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content qc-data">
                    <div class="modal-header qc-data-header">
                        <h4 class="modal-title">Yield - Gigabases</h4>
                    </div>
                    <div class="modal-body qc-data-list">
                        <ul class="d-none d-md-block">
                        {% for data in qcData.yields %}
                            <li>Average: {{ data.average|int() }}</li>
                            <li>Minimum: {{ data.minimum|int() }}</li>
                            <li>Maximum: {{ data.maximum|int() }}</li>
                        {% endfor %}
                        </ul>
                        <div id="yieldChartContainer" class="chart-container">
                            <canvas id="yield-chart"></canvas>
                        </div>
                    </div>
                    <div class="modal-footer qc-data-footer">
                        <button type="button" class="btn qc-data-btn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="clusterDensityModal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content qc-data">
                    <div class="modal-header qc-data-header">
                        <h4 class="modal-title">Cluster Density - K/mm2</h4>
                    </div>
                    <div class="modal-body qc-data-list">
                        <ul class="d-none d-md-block">
                        {% for data in qcData.clusterDensity %}
                            <li>Average: {{ data.average|int() }}</li>
                            <li>Minimum: {{ data.minimum|int() }}</li>
                            <li>Maximum: {{ data.maximum|int() }}</li>
                        {% endfor %}
                        </ul>
                        <div id="clusterChartContainer" class="chart-container">
                            <canvas id="clusterDensity-chart"></canvas>
                        </div>
                    </div>
                    <div class="modal-footer qc-data-footer">
                        <button type="button" class="btn qc-data-btn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="passFilterModal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content qc-data">
                    <div class="modal-header qc-data-header">
                        <h4 class="modal-title">Pass Filter - %</h4>
                    </div>
                    <div class="modal-body qc-data-list">
                        <ul class="d-none d-md-block">
                        {% for data in qcData.passFilter %}
                            <li>Average: {{ data.average|int() }}</li>
                            <li>Minimum: {{ data.minimum|int() }}</li>
                            <li>Maximum: {{ data.maximum|int() }}</li>
                        {% endfor %}
                        </ul>
                        <div id="passFilterChartContainer" class="chart-container">
                            <canvas id="passFilter-chart"></canvas>
                        </div>
                    </div>
                    <div class="modal-footer qc-data-footer">
                        <button type="button" class="btn qc-data-btn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="q30Modal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content qc-data">
                    <div class="modal-header qc-data-header">
                        <h4 class="modal-title">Q30 Score - %</h4>
                    </div>
                    <div class="modal-body qc-data-list">
                        <ul class="d-none d-md-block">
                        {% for data in qcData.q30 %}
                            <li>Average: {{ data.average|int() }}</li>
                            <li>Minimum: {{ data.minimum|int() }}</li>
                            <li>Maximum: {{ data.maximum|int() }}</li>
                        {% endfor %}
                        </ul>
                        <div id="q30ChartContainer" class="chart-container">
                            <canvas id="q30-chart"></canvas>
                        </div>
                    </div>
                    <div class="modal-footer qc-data-footer">
                        <button type="button" class="btn qc-data-btn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--SEQUENCING-RUNS-END-->

    <!--OTHER-SEQUENCING-METRICS-->
    <section class="container">
        <h3>Other Sequencing Metrics</h3>
        <hr>
        <div class="row justify-content-center other-metrics">
            <div class="col-10 col-sm-5 col-md-5 col-lg-4"">
                <h4 class="page-subtitle">Chemistry</h4>
                <a data-toggle="modal" data-target="#chemistryModal">
                <div class="overlay-container-5">
                    <img class="img-overlay" src="{{ url_for('static', filename='images/chemistry.jpg') }}" alt="homepage-5">
                    <div class="overlay">
                    <div class="overlay-text">Sequencing Chemistry</div>
                    </div>
                </div>
                </a>
            </div>

            <div class="col-10 col-sm-5 col-md-5 col-lg-4"">
                <h4 class="page-subtitle">Experiments</h4>
                <a data-toggle="modal" data-target="#experimentModal">
                <div class="overlay-container-6">
                    <img class="img-overlay" src="{{ url_for('static', filename='images/experiments.jpg') }}" alt="experiments">
                    <div class="overlay">
                    <div class="overlay-text">Sequencing Experiments</div>
                    </div>
                </div>
                </a>
            </div>
        </div>

        <div id="chemistryModal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content qc-data">
                    <div class="modal-header qc-data-header">
                        <h4 class="modal-title">Chemistry</h4>
                    </div>
                    <div class="modal-body qc-data-list">
                        <ul>
                            <li>High300: {{ qcData.high300 }}</li>
                            <li>Mid300: {{ qcData.mid300 }}</li>
                            <li>Mid150: {{ qcData.mid150 }}</li>
                        </ul>
                        <div class="chart-container">
                            <canvas id="chemistry-chart"></canvas>
                        </div>
                    </div>
                    <div class="modal-footer qc-data-footer">
                        <button type="button" class="btn qc-data-btn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="experimentModal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content qc-data">
                    <div class="modal-header qc-data-header">
                        <h4 class="modal-title">Experiment</h4>
                    </div>
                    <div class="modal-body qc-data-list">
                        <ul>
                            <li>Genome: {{ qcData.genome }}</li>
                            <li>Exome: {{ qcData.exome }}</li>
                            <li>Capture: {{ qcData.capture }}</li>
                        </ul>
                        <div class="chart-container">
                            <canvas id="experiment-chart"></canvas>
                        </div>
                    </div>
                    <div class="modal-footer qc-data-footer">
                        <button type="button" class="btn qc-data-btn" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--OTHER-SEQUENCING-METRICS-END-->

{% endblock content %}

{% block footer_navbar %}

    <div class="row no-gutters footer-nav">
        <div class="col-12">
            <ul>
                <li>
                    <a href="#"><i class="fas fa-arrow-circle-up fa-1x"></i>Top</a>
                </li>
            </ul>
            <ul>
                <li><a class="footer-btn footer-login-btn" href="{{ url_for('login') }}">Login</a></li>
                <li><a class="footer-btn footer-signup-btn" href="{{ url_for('signup') }}">Sign Up</a></li>
            </ul>
        </div>
    </div>

{% endblock footer_navbar %}

{% block javascript %}

    <script>
        let labels = JSON.parse({{ labels|tojson }});
        let yields = JSON.parse({{ yields|tojson }});
        let clusterDensity = JSON.parse({{ clusterDensity|tojson }});
        let passFilter = JSON.parse({{ passFilter|tojson }});
        let q30 = JSON.parse({{ q30|tojson }});

        let chemistries = [];
        chemistries.push(JSON.parse({{ qcData.genome|tojson }}));
        chemistries.push(JSON.parse({{ qcData.exome|tojson }}));
        chemistries.push(JSON.parse({{ qcData.capture|tojson }}));

        let experiments = [];
        experiments.push(JSON.parse({{ qcData.high300|tojson }}));
        experiments.push(JSON.parse({{ qcData.mid300|tojson }}));
        experiments.push(JSON.parse({{ qcData.mid150|tojson }}));
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="/static/js/graphs.js"></script>

{% endblock javascript %}